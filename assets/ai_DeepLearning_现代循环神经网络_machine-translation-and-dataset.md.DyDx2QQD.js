import{_ as h,c as n,o as t,ag as l,j as i,a}from"./chunks/framework.C2Gjomh7.js";const D=JSON.parse('{"title":"æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†","description":"","frontmatter":{},"headers":[],"relativePath":"ai/DeepLearning/ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ/machine-translation-and-dataset.md","filePath":"ai/DeepLearning/ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ/machine-translation-and-dataset.md","lastUpdated":1756829839000}'),p={name:"ai/DeepLearning/ç°ä»£å¾ªç¯ç¥ç»ç½‘ç»œ/machine-translation-and-dataset.md"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.781ex",height:"1.52ex",role:"img",focusable:"false",viewBox:"0 -661 345 672","aria-hidden":"true"},r={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.781ex",height:"1.52ex",role:"img",focusable:"false",viewBox:"0 -661 345 672","aria-hidden":"true"},d={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},g={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.262ex",height:"1.557ex",role:"img",focusable:"false",viewBox:"0 -666 1000 688","aria-hidden":"true"};function o(y,s,F,c,u,m){return t(),n("div",null,[s[27]||(s[27]=l(`<h1 id="æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†" tabindex="-1">æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›† <a class="header-anchor" href="#æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†" aria-label="Permalink to &quot;æœºå™¨ç¿»è¯‘ä¸æ•°æ®é›†&quot;">â€‹</a></h1><p>ğŸ·ï¸<code>sec_machine_translation</code></p><p>è¯­è¨€æ¨¡å‹æ˜¯è‡ªç„¶è¯­è¨€å¤„ç†çš„å…³é”®ï¼Œ è€Œ<em>æœºå™¨ç¿»è¯‘</em>æ˜¯è¯­è¨€æ¨¡å‹æœ€æˆåŠŸçš„åŸºå‡†æµ‹è¯•ã€‚ å› ä¸ºæœºå™¨ç¿»è¯‘æ­£æ˜¯å°†è¾“å…¥åºåˆ—è½¬æ¢æˆè¾“å‡ºåºåˆ—çš„ <em>åºåˆ—è½¬æ¢æ¨¡å‹</em>ï¼ˆsequence transductionï¼‰çš„æ ¸å¿ƒé—®é¢˜ã€‚ åºåˆ—è½¬æ¢æ¨¡å‹åœ¨å„ç±»ç°ä»£äººå·¥æ™ºèƒ½åº”ç”¨ä¸­å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œ å› æ­¤æˆ‘ä»¬å°†å…¶åšä¸ºæœ¬ç« å‰©ä½™éƒ¨åˆ†å’Œ :numref:<code>chap_attention</code>çš„é‡ç‚¹ã€‚ ä¸ºæ­¤ï¼Œæœ¬èŠ‚å°†ä»‹ç»æœºå™¨ç¿»è¯‘é—®é¢˜åŠå…¶åæ–‡éœ€è¦ä½¿ç”¨çš„æ•°æ®é›†ã€‚</p><p><em>æœºå™¨ç¿»è¯‘</em>ï¼ˆmachine translationï¼‰æŒ‡çš„æ˜¯ å°†åºåˆ—ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ã€‚ äº‹å®ä¸Šï¼Œè¿™ä¸ªç ”ç©¶é¢†åŸŸå¯ä»¥è¿½æº¯åˆ°æ•°å­—è®¡ç®—æœºå‘æ˜åä¸ä¹…çš„20ä¸–çºª40å¹´ä»£ï¼Œ ç‰¹åˆ«æ˜¯åœ¨ç¬¬äºŒæ¬¡ä¸–ç•Œå¤§æˆ˜ä¸­ä½¿ç”¨è®¡ç®—æœºç ´è§£è¯­è¨€ç¼–ç ã€‚ å‡ åå¹´æ¥ï¼Œåœ¨ä½¿ç”¨ç¥ç»ç½‘ç»œè¿›è¡Œç«¯åˆ°ç«¯å­¦ä¹ çš„å…´èµ·ä¹‹å‰ï¼Œ ç»Ÿè®¡å­¦æ–¹æ³•åœ¨è¿™ä¸€é¢†åŸŸä¸€ç›´å æ®ä¸»å¯¼åœ°ä½ :cite:<code>Brown.Cocke.Della-Pietra.ea.1988,Brown.Cocke.Della-Pietra.ea.1990</code>ã€‚ å› ä¸º<em>ç»Ÿè®¡æœºå™¨ç¿»è¯‘</em>ï¼ˆstatistical machine translationï¼‰æ¶‰åŠäº† ç¿»è¯‘æ¨¡å‹å’Œè¯­è¨€æ¨¡å‹ç­‰ç»„æˆéƒ¨åˆ†çš„ç»Ÿè®¡åˆ†æï¼Œ å› æ­¤åŸºäºç¥ç»ç½‘ç»œçš„æ–¹æ³•é€šå¸¸è¢«ç§°ä¸º <em>ç¥ç»æœºå™¨ç¿»è¯‘</em>ï¼ˆneural machine translationï¼‰ï¼Œ ç”¨äºå°†ä¸¤ç§ç¿»è¯‘æ¨¡å‹åŒºåˆ†å¼€æ¥ã€‚</p><p>æœ¬ä¹¦çš„å…³æ³¨ç‚¹æ˜¯ç¥ç»ç½‘ç»œæœºå™¨ç¿»è¯‘æ–¹æ³•ï¼Œå¼ºè°ƒçš„æ˜¯ç«¯åˆ°ç«¯çš„å­¦ä¹ ã€‚ ä¸ :numref:<code>sec_language_model</code>ä¸­çš„è¯­æ–™åº“ æ˜¯å•ä¸€è¯­è¨€çš„è¯­è¨€æ¨¡å‹é—®é¢˜å­˜åœ¨ä¸åŒï¼Œ æœºå™¨ç¿»è¯‘çš„æ•°æ®é›†æ˜¯ç”±æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„æ–‡æœ¬åºåˆ—å¯¹ç»„æˆçš„ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹æ³•æ¥é¢„å¤„ç†æœºå™¨ç¿»è¯‘æ•°æ®é›†ï¼Œ è€Œä¸æ˜¯å¤ç”¨è¯­è¨€æ¨¡å‹çš„é¢„å¤„ç†ç¨‹åºã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•å°†é¢„å¤„ç†åçš„æ•°æ®åŠ è½½åˆ°å°æ‰¹é‡ä¸­ç”¨äºè®­ç»ƒã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mxnet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mxnet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np, npx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">npx.set_np()</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab pytorch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab tensorflow</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tensorflow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tensorflow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tf</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab paddle</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> paddle </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> warnings</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">warnings.filterwarnings(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ignore&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> paddle</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span></code></pre></div><h2 id="ä¸‹è½½å’Œé¢„å¤„ç†æ•°æ®é›†" tabindex="-1">[<strong>ä¸‹è½½å’Œé¢„å¤„ç†æ•°æ®é›†</strong>] <a class="header-anchor" href="#ä¸‹è½½å’Œé¢„å¤„ç†æ•°æ®é›†" aria-label="Permalink to &quot;[**ä¸‹è½½å’Œé¢„å¤„ç†æ•°æ®é›†**]&quot;">â€‹</a></h2><p>é¦–å…ˆï¼Œä¸‹è½½ä¸€ä¸ªç”±<a href="http://www.manythings.org/anki/" target="_blank" rel="noreferrer">Tatoebaé¡¹ç›®çš„åŒè¯­å¥å­å¯¹</a> ç»„æˆçš„â€œè‹±ï¼æ³•â€æ•°æ®é›†ï¼Œæ•°æ®é›†ä¸­çš„æ¯ä¸€è¡Œéƒ½æ˜¯åˆ¶è¡¨ç¬¦åˆ†éš”çš„æ–‡æœ¬åºåˆ—å¯¹ï¼Œ åºåˆ—å¯¹ç”±è‹±æ–‡æ–‡æœ¬åºåˆ—å’Œç¿»è¯‘åçš„æ³•è¯­æ–‡æœ¬åºåˆ—ç»„æˆã€‚ è¯·æ³¨æ„ï¼Œæ¯ä¸ªæ–‡æœ¬åºåˆ—å¯ä»¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œ ä¹Ÿå¯ä»¥æ˜¯åŒ…å«å¤šä¸ªå¥å­çš„ä¸€ä¸ªæ®µè½ã€‚ åœ¨è¿™ä¸ªå°†è‹±è¯­ç¿»è¯‘æˆæ³•è¯­çš„æœºå™¨ç¿»è¯‘é—®é¢˜ä¸­ï¼Œ è‹±è¯­æ˜¯<em>æºè¯­è¨€</em>ï¼ˆsource languageï¼‰ï¼Œ æ³•è¯­æ˜¯<em>ç›®æ ‡è¯­è¨€</em>ï¼ˆtarget languageï¼‰ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d2l.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATA_HUB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fra-eng&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (d2l.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">DATA_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;fra-eng.zip&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                           &#39;94646ad1522d915e7b0f9296181140edcf86a4f5&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> read_data_nmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;è½½å…¥â€œè‹±è¯­ï¼æ³•è¯­â€æ•°æ®é›†&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.download_extract(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fra-eng&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(os.path.join(data_dir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fra.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;r&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">             encoding</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f.read()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">raw_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> read_data_nmt()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(raw_text[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">75</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p>ä¸‹è½½æ•°æ®é›†åï¼ŒåŸå§‹æ–‡æœ¬æ•°æ®éœ€è¦ç»è¿‡[<strong>å‡ ä¸ªé¢„å¤„ç†æ­¥éª¤</strong>]ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨ç©ºæ ¼ä»£æ›¿<em>ä¸é—´æ–­ç©ºæ ¼</em>ï¼ˆnon-breaking spaceï¼‰ï¼Œ ä½¿ç”¨å°å†™å­—æ¯æ›¿æ¢å¤§å†™å­—æ¯ï¼Œå¹¶åœ¨å•è¯å’Œæ ‡ç‚¹ç¬¦å·ä¹‹é—´æ’å…¥ç©ºæ ¼ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> preprocess_nmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;é¢„å¤„ç†â€œè‹±è¯­ï¼æ³•è¯­â€æ•°æ®é›†&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> no_space</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(char, prev_char):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> char </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;,.!?&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prev_char </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39; &#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½¿ç”¨ç©ºæ ¼æ›¿æ¢ä¸é—´æ–­ç©ºæ ¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½¿ç”¨å°å†™å­—æ¯æ›¿æ¢å¤§å†™å­—æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text.replace(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\u202f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).replace(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\xa0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).lower()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åœ¨å•è¯å’Œæ ‡ç‚¹ç¬¦å·ä¹‹é—´æ’å…¥ç©ºæ ¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> char </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> no_space(char, text[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> char</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, char </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(out)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> preprocess_nmt(raw_text)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><h2 id="è¯å…ƒåŒ–" tabindex="-1">[<strong>è¯å…ƒåŒ–</strong>] <a class="header-anchor" href="#è¯å…ƒåŒ–" aria-label="Permalink to &quot;[**è¯å…ƒåŒ–**]&quot;">â€‹</a></h2>`,15)),i("p",null,[s[4]||(s[4]=a("ä¸ :numref:",-1)),s[5]||(s[5]=i("code",null,"sec_language_model",-1)),s[6]||(s[6]=a("ä¸­çš„å­—ç¬¦çº§è¯å…ƒåŒ–ä¸åŒï¼Œ åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢å•è¯çº§è¯å…ƒåŒ– ï¼ˆæœ€å…ˆè¿›çš„æ¨¡å‹å¯èƒ½ä½¿ç”¨æ›´é«˜çº§çš„è¯å…ƒåŒ–æŠ€æœ¯ï¼‰ã€‚ ä¸‹é¢çš„",-1)),s[7]||(s[7]=i("code",null,"tokenize_nmt",-1)),s[8]||(s[8]=a("å‡½æ•°å¯¹å‰",-1)),s[9]||(s[9]=i("code",null,"num_examples",-1)),s[10]||(s[10]=a("ä¸ªæ–‡æœ¬åºåˆ—å¯¹è¿›è¡Œè¯å…ƒï¼Œ å…¶ä¸­æ¯ä¸ªè¯å…ƒè¦ä¹ˆæ˜¯ä¸€ä¸ªè¯ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·ã€‚ æ­¤å‡½æ•°è¿”å›ä¸¤ä¸ªè¯å…ƒåˆ—è¡¨ï¼š",-1)),s[11]||(s[11]=i("code",null,"source",-1)),s[12]||(s[12]=a("å’Œ",-1)),s[13]||(s[13]=i("code",null,"target",-1)),s[14]||(s[14]=a("ï¼š ",-1)),s[15]||(s[15]=i("code",null,"source[i]",-1)),s[16]||(s[16]=a("æ˜¯æºè¯­è¨€ï¼ˆè¿™é‡Œæ˜¯è‹±è¯­ï¼‰ç¬¬",-1)),i("mjx-container",k,[(t(),n("svg",e,[...s[0]||(s[0]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)])])),s[1]||(s[1]=i("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"i")])],-1))]),s[17]||(s[17]=a("ä¸ªæ–‡æœ¬åºåˆ—çš„è¯å…ƒåˆ—è¡¨ï¼Œ ",-1)),s[18]||(s[18]=i("code",null,"target[i]",-1)),s[19]||(s[19]=a("æ˜¯ç›®æ ‡è¯­è¨€ï¼ˆè¿™é‡Œæ˜¯æ³•è¯­ï¼‰ç¬¬",-1)),i("mjx-container",r,[(t(),n("svg",E,[...s[2]||(s[2]=[i("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[i("g",{"data-mml-node":"math"},[i("g",{"data-mml-node":"mi"},[i("path",{"data-c":"1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)])])),s[3]||(s[3]=i("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mi",null,"i")])],-1))]),s[20]||(s[20]=a("ä¸ªæ–‡æœ¬åºåˆ—çš„è¯å…ƒåˆ—è¡¨ã€‚",-1))]),s[28]||(s[28]=l(`<div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tokenize_nmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, num_examples</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;è¯å…ƒåŒ–â€œè‹±è¯­ï¼æ³•è¯­â€æ•°æ®æ•°æ®é›†&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    source, target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [], []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_examples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_examples:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        parts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parts) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            source.append(parts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            target.append(parts[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39; &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> source, target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source, target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tokenize_nmt(text)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">source[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], target[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div>`,1)),i("p",null,[s[23]||(s[23]=a("è®©æˆ‘ä»¬[",-1)),s[24]||(s[24]=i("strong",null,"ç»˜åˆ¶æ¯ä¸ªæ–‡æœ¬åºåˆ—æ‰€åŒ…å«çš„è¯å…ƒæ•°é‡çš„ç›´æ–¹å›¾",-1)),s[25]||(s[25]=a("]ã€‚ åœ¨è¿™ä¸ªç®€å•çš„â€œè‹±ï¼æ³•â€æ•°æ®é›†ä¸­ï¼Œå¤§å¤šæ•°æ–‡æœ¬åºåˆ—çš„è¯å…ƒæ•°é‡å°‘äº",-1)),i("mjx-container",d,[(t(),n("svg",g,[...s[21]||(s[21]=[l('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g>',1)])])),s[22]||(s[22]=i("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[i("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[i("mn",null,"20")])],-1))]),s[26]||(s[26]=a("ä¸ªã€‚",-1))]),s[29]||(s[29]=l(`<div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> show_list_len_pair_hist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(legend, xlabel, ylabel, xlist, ylist):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;ç»˜åˆ¶åˆ—è¡¨é•¿åº¦å¯¹çš„ç›´æ–¹å›¾&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    d2l.set_figsize()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _, _, patches </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.plt.hist(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(l) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xlist], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(l) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ylist]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    d2l.plt.xlabel(xlabel)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    d2l.plt.ylabel(ylabel)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> patches[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].patches:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        patch.set_hatch(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    d2l.plt.legend(legend)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">show_list_len_pair_hist([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;source&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;target&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;# tokens per sequence&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &#39;count&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, source, target)</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">;</span></span></code></pre></div><h2 id="è¯è¡¨" tabindex="-1">[<strong>è¯è¡¨</strong>] <a class="header-anchor" href="#è¯è¡¨" aria-label="Permalink to &quot;[**è¯è¡¨**]&quot;">â€‹</a></h2><p>ç”±äºæœºå™¨ç¿»è¯‘æ•°æ®é›†ç”±è¯­è¨€å¯¹ç»„æˆï¼Œ å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä¸ºæºè¯­è¨€å’Œç›®æ ‡è¯­è¨€æ„å»ºä¸¤ä¸ªè¯è¡¨ã€‚ ä½¿ç”¨å•è¯çº§è¯å…ƒåŒ–æ—¶ï¼Œè¯è¡¨å¤§å°å°†æ˜æ˜¾å¤§äºä½¿ç”¨å­—ç¬¦çº§è¯å…ƒåŒ–æ—¶çš„è¯è¡¨å¤§å°ã€‚ ä¸ºäº†ç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å‡ºç°æ¬¡æ•°å°‘äº2æ¬¡çš„ä½é¢‘ç‡è¯å…ƒ è§†ä¸ºç›¸åŒçš„æœªçŸ¥ï¼ˆâ€œ&lt;unk&gt;â€ï¼‰è¯å…ƒã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº†é¢å¤–çš„ç‰¹å®šè¯å…ƒï¼Œ ä¾‹å¦‚åœ¨å°æ‰¹é‡æ—¶ç”¨äºå°†åºåˆ—å¡«å……åˆ°ç›¸åŒé•¿åº¦çš„å¡«å……è¯å…ƒï¼ˆâ€œ&lt;pad&gt;â€ï¼‰ï¼Œ ä»¥åŠåºåˆ—çš„å¼€å§‹è¯å…ƒï¼ˆâ€œ&lt;bos&gt;â€ï¼‰å’Œç»“æŸè¯å…ƒï¼ˆâ€œ&lt;eos&gt;â€ï¼‰ã€‚ è¿™äº›ç‰¹æ®Šè¯å…ƒåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­æ¯”è¾ƒå¸¸ç”¨ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src_vocab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.Vocab(source, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">min_freq</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                      reserved_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;bos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;eos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(src_vocab)</span></span></code></pre></div><h2 id="åŠ è½½æ•°æ®é›†" tabindex="-1">åŠ è½½æ•°æ®é›† <a class="header-anchor" href="#åŠ è½½æ•°æ®é›†" aria-label="Permalink to &quot;åŠ è½½æ•°æ®é›†&quot;">â€‹</a></h2><p>ğŸ·ï¸<code>subsec_mt_data_loading</code></p><p>å›æƒ³ä¸€ä¸‹ï¼Œè¯­è¨€æ¨¡å‹ä¸­çš„[<strong>åºåˆ—æ ·æœ¬éƒ½æœ‰ä¸€ä¸ªå›ºå®šçš„é•¿åº¦</strong>]ï¼Œ æ— è®ºè¿™ä¸ªæ ·æœ¬æ˜¯ä¸€ä¸ªå¥å­çš„ä¸€éƒ¨åˆ†è¿˜æ˜¯è·¨è¶Šäº†å¤šä¸ªå¥å­çš„ä¸€ä¸ªç‰‡æ–­ã€‚ è¿™ä¸ªå›ºå®šé•¿åº¦æ˜¯ç”± :numref:<code>sec_language_model</code>ä¸­çš„ <code>num_steps</code>ï¼ˆæ—¶é—´æ­¥æ•°æˆ–è¯å…ƒæ•°é‡ï¼‰å‚æ•°æŒ‡å®šçš„ã€‚ åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯ç”±æºå’Œç›®æ ‡ç»„æˆçš„æ–‡æœ¬åºåˆ—å¯¹ï¼Œ å…¶ä¸­çš„æ¯ä¸ªæ–‡æœ¬åºåˆ—å¯èƒ½å…·æœ‰ä¸åŒçš„é•¿åº¦ã€‚</p><p>ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥é€šè¿‡<em>æˆªæ–­</em>ï¼ˆtruncationï¼‰å’Œ <em>å¡«å……</em>ï¼ˆpaddingï¼‰æ–¹å¼å®ç°ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªå°æ‰¹é‡çš„æ–‡æœ¬åºåˆ—ã€‚ å‡è®¾åŒä¸€ä¸ªå°æ‰¹é‡ä¸­çš„æ¯ä¸ªåºåˆ—éƒ½åº”è¯¥å…·æœ‰ç›¸åŒçš„é•¿åº¦<code>num_steps</code>ï¼Œ é‚£ä¹ˆå¦‚æœæ–‡æœ¬åºåˆ—çš„è¯å…ƒæ•°ç›®å°‘äº<code>num_steps</code>æ—¶ï¼Œ æˆ‘ä»¬å°†ç»§ç»­åœ¨å…¶æœ«å°¾æ·»åŠ ç‰¹å®šçš„â€œ&lt;pad&gt;â€è¯å…ƒï¼Œ ç›´åˆ°å…¶é•¿åº¦è¾¾åˆ°<code>num_steps</code>ï¼› åä¹‹ï¼Œæˆ‘ä»¬å°†æˆªæ–­æ–‡æœ¬åºåˆ—æ—¶ï¼Œåªå–å…¶å‰<code>num_steps</code>Â ä¸ªè¯å…ƒï¼Œ å¹¶ä¸”ä¸¢å¼ƒå‰©ä½™çš„è¯å…ƒã€‚è¿™æ ·ï¼Œæ¯ä¸ªæ–‡æœ¬åºåˆ—å°†å…·æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œ ä»¥ä¾¿ä»¥ç›¸åŒå½¢çŠ¶çš„å°æ‰¹é‡è¿›è¡ŒåŠ è½½ã€‚</p><p>å¦‚å‰æ‰€è¿°ï¼Œä¸‹é¢çš„<code>truncate_pad</code>å‡½æ•°å°†(<strong>æˆªæ–­æˆ–å¡«å……æ–‡æœ¬åºåˆ—</strong>)ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> truncate_pad</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line, num_steps, padding_token):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æˆªæ–­æˆ–å¡«å……æ–‡æœ¬åºåˆ—&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_steps:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line[:num_steps]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æˆªæ–­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [padding_token] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (num_steps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line))  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¡«å……</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">truncate_pad(src_vocab[source[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, src_vocab[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†æ–‡æœ¬åºåˆ— [<strong>è½¬æ¢æˆå°æ‰¹é‡æ•°æ®é›†ç”¨äºè®­ç»ƒ</strong>]ã€‚ æˆ‘ä»¬å°†ç‰¹å®šçš„â€œ&lt;eos&gt;â€è¯å…ƒæ·»åŠ åˆ°æ‰€æœ‰åºåˆ—çš„æœ«å°¾ï¼Œ ç”¨äºè¡¨ç¤ºåºåˆ—çš„ç»“æŸã€‚ å½“æ¨¡å‹é€šè¿‡ä¸€ä¸ªè¯å…ƒæ¥ä¸€ä¸ªè¯å…ƒåœ°ç”Ÿæˆåºåˆ—è¿›è¡Œé¢„æµ‹æ—¶ï¼Œ ç”Ÿæˆçš„â€œ&lt;eos&gt;â€è¯å…ƒè¯´æ˜å®Œæˆäº†åºåˆ—è¾“å‡ºå·¥ä½œã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è®°å½•äº†æ¯ä¸ªæ–‡æœ¬åºåˆ—çš„é•¿åº¦ï¼Œ ç»Ÿè®¡é•¿åº¦æ—¶æ’é™¤äº†å¡«å……è¯å…ƒï¼Œ åœ¨ç¨åå°†è¦ä»‹ç»çš„ä¸€äº›æ¨¡å‹ä¼šéœ€è¦è¿™ä¸ªé•¿åº¦ä¿¡æ¯ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build_array_nmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lines, vocab, num_steps):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;å°†æœºå™¨ç¿»è¯‘çš„æ–‡æœ¬åºåˆ—è½¬æ¢æˆå°æ‰¹é‡&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lines </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [vocab[l] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lines]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lines </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [vocab[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;eos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lines]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    array </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.tensor([truncate_pad(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        l, num_steps, vocab[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lines])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    valid_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.reduce_sum(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        d2l.astype(array </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vocab[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], d2l.int32), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> array, valid_len</span></span></code></pre></div><h2 id="è®­ç»ƒæ¨¡å‹" tabindex="-1">[<strong>è®­ç»ƒæ¨¡å‹</strong>] <a class="header-anchor" href="#è®­ç»ƒæ¨¡å‹" aria-label="Permalink to &quot;[**è®­ç»ƒæ¨¡å‹**]&quot;">â€‹</a></h2><p>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰<code>load_data_nmt</code>å‡½æ•°æ¥è¿”å›æ•°æ®è¿­ä»£å™¨ï¼Œ ä»¥åŠæºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„ä¸¤ç§è¯è¡¨ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@save</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> load_data_nmt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(batch_size, num_steps, num_examples</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;è¿”å›ç¿»è¯‘æ•°æ®é›†çš„è¿­ä»£å™¨å’Œè¯è¡¨&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> preprocess_nmt(read_data_nmt())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    source, target </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tokenize_nmt(text, num_examples)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    src_vocab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.Vocab(source, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">min_freq</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                          reserved_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;bos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;eos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tgt_vocab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.Vocab(target, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">min_freq</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                          reserved_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;pad&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;bos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;eos&gt;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    src_array, src_valid_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build_array_nmt(source, src_vocab, num_steps)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tgt_array, tgt_valid_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build_array_nmt(target, tgt_vocab, num_steps)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_arrays </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (src_array, src_valid_len, tgt_array, tgt_valid_len)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d2l.load_array(data_arrays, batch_size)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data_iter, src_vocab, tgt_vocab</span></span></code></pre></div><p>ä¸‹é¢æˆ‘ä»¬[<strong>è¯»å‡ºâ€œè‹±è¯­ï¼æ³•è¯­â€æ•°æ®é›†ä¸­çš„ç¬¬ä¸€ä¸ªå°æ‰¹é‡æ•°æ®</strong>]ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#@tab all</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">train_iter, src_vocab, tgt_vocab </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> load_data_nmt(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">num_steps</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> X, X_valid_len, Y, Y_valid_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> train_iter:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;X:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, d2l.astype(X, d2l.int32))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Xçš„æœ‰æ•ˆé•¿åº¦:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, X_valid_len)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Y:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, d2l.astype(Y, d2l.int32))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Yçš„æœ‰æ•ˆé•¿åº¦:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Y_valid_len)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    break</span></span></code></pre></div><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-label="Permalink to &quot;å°ç»“&quot;">â€‹</a></h2><ul><li>æœºå™¨ç¿»è¯‘æŒ‡çš„æ˜¯å°†æ–‡æœ¬åºåˆ—ä»ä¸€ç§è¯­è¨€è‡ªåŠ¨ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ã€‚</li><li>ä½¿ç”¨å•è¯çº§è¯å…ƒåŒ–æ—¶çš„è¯è¡¨å¤§å°ï¼Œå°†æ˜æ˜¾å¤§äºä½¿ç”¨å­—ç¬¦çº§è¯å…ƒåŒ–æ—¶çš„è¯è¡¨å¤§å°ã€‚ä¸ºäº†ç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä½é¢‘è¯å…ƒè§†ä¸ºç›¸åŒçš„æœªçŸ¥è¯å…ƒã€‚</li><li>é€šè¿‡æˆªæ–­å’Œå¡«å……æ–‡æœ¬åºåˆ—ï¼Œå¯ä»¥ä¿è¯æ‰€æœ‰çš„æ–‡æœ¬åºåˆ—éƒ½å…·æœ‰ç›¸åŒçš„é•¿åº¦ï¼Œä»¥ä¾¿ä»¥å°æ‰¹é‡çš„æ–¹å¼åŠ è½½ã€‚</li></ul><h2 id="ç»ƒä¹ " tabindex="-1">ç»ƒä¹  <a class="header-anchor" href="#ç»ƒä¹ " aria-label="Permalink to &quot;ç»ƒä¹ &quot;">â€‹</a></h2><ol><li>åœ¨<code>load_data_nmt</code>å‡½æ•°ä¸­å°è¯•ä¸åŒçš„<code>num_examples</code>å‚æ•°å€¼ã€‚è¿™å¯¹æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„è¯è¡¨å¤§å°æœ‰ä½•å½±å“ï¼Ÿ</li><li>æŸäº›è¯­è¨€ï¼ˆä¾‹å¦‚ä¸­æ–‡å’Œæ—¥è¯­ï¼‰çš„æ–‡æœ¬æ²¡æœ‰å•è¯è¾¹ç•ŒæŒ‡ç¤ºç¬¦ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼‰ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå•è¯çº§è¯å…ƒåŒ–ä»ç„¶æ˜¯ä¸ªå¥½ä¸»æ„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li></ol><p>:begin_tab:<code>mxnet</code><a href="https://discuss.d2l.ai/t/2777" target="_blank" rel="noreferrer">Discussions</a> :end_tab:</p><p>:begin_tab:<code>pytorch</code><a href="https://discuss.d2l.ai/t/2776" target="_blank" rel="noreferrer">Discussions</a> :end_tab:</p><p>:begin_tab:<code>paddle</code><a href="https://discuss.d2l.ai/t/11836" target="_blank" rel="noreferrer">Discussions</a> :end_tab:</p>`,24))])}const C=h(p,[["render",o]]);export{D as __pageData,C as default};
